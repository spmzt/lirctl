#!/bin/sh
#
# Version
MANRSCTL_VERSION="0.1.0"

. /usr/local/share/manrsctl/common.sh

[ $# -lt 1 ] && usage

export CMD=$1
shift

# Handle special-case commands first.
case "${CMD}" in
version | -v | --version)
  echo "${MANRSCTL_VERSION}"
  exit 0
  ;;
help | -h | --help)
  usage
  ;;
esac

# Find config file
if [ -f $HOME/.config/manrsctl/manrsctl.yaml ]
then
  export MANRSCTL_CONF="$(realpath $HOME/.config/manrsctl/manrsctl.yaml)"
elif [ -f /usr/local/etc/manrsctl/manrsctl.yaml ]
then
  export MANRSCTL_CONF="$(realpath /usr/local/etc/manrsctl/manrsctl.yaml)"
elif [ -f /etc/manrsctl/manrsctl.yaml ]
then
  export MANRSCTL_CONF="$(realpath /etc/manrsctl/manrsctl.yaml)"
else
  print_error "(manrsctl) Can't find configuration file."
  exit 1
fi

SCRIPTPATH="/usr/local/share/manrsctl/${CMD}.sh"
if [ -f "${SCRIPTPATH}" ]; then
  : "${UMASK:=022}"
  umask "${UMASK}"

  : "${SH:=sh}"
  exec "${SH}" "${SCRIPTPATH}" "$@"
else
  print_error "${SCRIPTPATH} not found."
fi